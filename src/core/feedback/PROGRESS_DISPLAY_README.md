# 進行状況表示機能

SFTシステムに進行状況表示機能を追加しました。macOSのDockアイコンとターミナルの両方で進行状況を確認できます。

## 🚀 機能概要

### 1. **macOS Dock進行状況表示**
- Dockアイコンに進行状況バーが表示されます
- 0-100%の進行状況をリアルタイム更新
- バックグラウンドで動作

### 2. **Rich UI進行状況表示**
- ターミナルに美しい進行状況パネルを表示
- 各フェーズの詳細進行状況
- 経過時間・残り時間の表示
- スピナーアニメーション

### 3. **フェーズ別進行管理**
- データ読み込み（5%）
- データ変換・分割（15%）
- ファイルアップロード（10%）
- ファインチューニング（60%）
- モデル評価（8%）
- 結果保存（2%）

## 📊 表示例

### ターミナル表示
```
┌─ 🚀 OpenAI SFT 実行状況 ─┐
│ 経過時間: 0:15:32        │
│ 全体進行: 45.2% (3/6 フェーズ完了) │
│ 現在のフェーズ: ファインチューニング │
│                          │
│ ⠋ ファインチューニング実行 ████████████▌         45% 0:15:32 0:18:45 │
│ ✅ データセットの読み込み・分割 ████████████████████ 100% 0:00:30 -:--:-- │
│ ✅ データ変換・準備       ████████████████████ 100% 0:02:15 -:--:-- │
│ ✅ ファイルアップロード    ████████████████████ 100% 0:01:45 -:--:-- │
└──────────────────────────┘
```

### Dock表示
- Dockのアプリアイコンに青い進行状況バーが表示
- 進行状況に応じてバーが伸びる

## 🔧 使用方法

### 基本使用
```python
from openai_sft import OpenAISFT

# 進行状況表示ありで実行（デフォルト）
sft = OpenAISFT(show_progress=True)
result = sft.run_full_pipeline()

# 進行状況表示なしで実行
sft = OpenAISFT(show_progress=False)
result = sft.run_full_pipeline()
```

### コマンドライン実行
```bash
# 標準実行（進行状況表示あり）
python openai_sft_example.py

# 小規模テスト実行
python openai_sft_example.py --epochs 3 --max-samples 100
```

## 📋 進行状況の詳細

### フェーズ1: データ読み込み（重み: 5%）
```
- KokoChatデータセット読み込み
- サンプル数制限適用
- 8:1:1データ分割
```

### フェーズ2: データ変換・準備（重み: 15%）
```
- 学習データ変換 (33%)
- テストデータ変換 (66%)
- 検証データ変換 (100%)
```

### フェーズ3: ファイルアップロード（重み: 10%）
```
- 学習用JSONLファイルをOpenAIサーバーへアップロード
- ファイルサイズ: 約2-3GB
```

### フェーズ4: ファインチューニング（重み: 60%）
```
- OpenAIサーバーでの学習実行
- 学習済みトークン数による進行状況推定
- 1分間隔でステータス確認
```

### フェーズ5: モデル評価（重み: 8%）
```
- テストデータでの評価
- 検証データでの評価
- 推論結果の収集
```

### フェーズ6: 結果保存（重み: 2%）
```
- 評価結果の保存
- モデル情報ファイルの作成
- 統計情報の出力
```

## 🎨 カスタマイズ

### 進行状況監視の無効化
```python
# テストやデバッグ時に進行状況表示を無効化
sft = OpenAISFT(show_progress=False)
```

### フェーズ重みの調整
`progress_monitor.py`の`phase_info`辞書で重みを調整可能：

```python
self.phase_info = {
    "data_loading": {"name": "データ読み込み", "weight": 5},
    "data_preparation": {"name": "データ変換・分割", "weight": 15},
    "file_upload": {"name": "ファイルアップロード", "weight": 10},
    "fine_tuning": {"name": "ファインチューニング", "weight": 60},
    "evaluation": {"name": "モデル評価", "weight": 8},
    "results_saving": {"name": "結果保存", "weight": 2}
}
```

## 🔍 トラブルシューティング

### Q: Dock進行状況が表示されない
A: macOS以外では表示されません。macOSでも以下を確認：
- システム環境設定 > Dock > 進行状況の表示が有効
- Dockの再起動: `killall Dock`

### Q: Rich UIが表示されない
A: 依存ライブラリが不足している可能性：
```bash
rye add rich tqdm
```

### Q: 進行状況が更新されない
A: 以下を確認：
- ネットワーク接続
- OpenAI APIキーの有効性
- ファインチューニングジョブのステータス

## 📈 パフォーマンス影響

### リソース使用量
- CPU: +1-2%（進行状況更新処理）
- メモリ: +10-20MB（Rich UI）
- ネットワーク: 変化なし

### 更新頻度
- Dock: 5秒間隔（10%刻み）
- Rich UI: 2Hz（0.5秒間隔）
- ファインチューニング: 1分間隔

## 🎯 実行例

### 小規模テスト（約15分）
```bash
python openai_sft_example.py --epochs 3 --max-samples 100
```

### 標準実行（約1時間）
```bash
python openai_sft_example.py --epochs 10 --batch-size 32
```

進行状況表示により、実行状況を視覚的に確認でき、予定時間の把握や問題の早期発見が可能になります。
